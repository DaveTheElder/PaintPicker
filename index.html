<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CMYK Paint Ratio Mixer (Saved Colors)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f8f8;
      text-align: center;
      padding: 20px;
      margin: 0;
    }
    h1 { color: #333; margin-bottom: 10px; }
    .container {
      max-width: 700px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    #colorPreview {
      width: 160px;
      height: 160px;
      margin: 15px auto;
      border: 3px solid #aaa;
      border-radius: 10px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.15);
    }
    .ratio {
      font-size: 1.25em;
      margin: 10px 0;
      padding: 10px;
      background: #f0f8ff;
      border-radius: 8px;
    }
    label { font-weight: bold; margin-right: 8px; }
    input[type="color"] {
      width: 70px;
      height: 45px;
      border: none;
      cursor: pointer;
      vertical-align: middle;
    }
    #targetHex { font-family: monospace; font-size: 1.2em; margin: 8px 0; }
    #saveSection {
      margin: 20px 0;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 10px;
    }
    #colorName { 
      padding: 8px; 
      width: 180px; 
      margin-right: 10px; 
      font-size: 1em; 
    }
    button {
      padding: 8px 16px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #4CAF50;
      color: white;
    }
    button:hover { background: #45a049; }
    #savedColors {
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 8px;
      text-align: left;
    }
    .saved-item {
      display: flex;
      align-items: center;
      padding: 8px;
      margin: 6px 0;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .saved-item:hover { background: #e8f4ff; }
    .saved-swatch {
      width: 36px;
      height: 36px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-right: 12px;
    }
    small { color: #555; font-size: 0.9em; }
    @media (max-width: 500px) {
      #colorPreview { width: 140px; height: 140px; }
      .ratio { font-size: 1.1em; padding: 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>CMYK Paint Ratio Mixer</h1>
    <p>Pick a color → see Cyan : Magenta : Yellow : Black : White ratios for mixing \~10 ml.<br>
       Save your favorites for quick access.</p>

    <label for="colorPicker">Pick color:</label>
    <input type="color" id="colorPicker" value="#808080" />

    <div id="colorPreview"></div>
    <div id="targetHex">#808080</div>

    <div class="ratio"><strong>Cyan:</strong> <span id="cyanRatio">0%</span> (\~<span id="cyanMl">0.0</span> ml)</div>
    <div class="ratio"><strong>Magenta:</strong> <span id="magentaRatio">0%</span> (\~<span id="magentaMl">0.0</span> ml)</div>
    <div class="ratio"><strong>Yellow:</strong> <span id="yellowRatio">0%</span> (\~<span id="yellowMl">0.0</span> ml)</div>
    <div class="ratio"><strong>Black:</strong> <span id="blackRatio">0%</span> (\~<span id="blackMl">0.0</span> ml)</div>
    <div class="ratio"><strong>White/Base:</strong> <span id="whiteRatio">0%</span> (\~<span id="whiteMl">0.0</span> ml)</div>

    <div id="saveSection">
      <input type="text" id="colorName" placeholder="Name this color (e.g. Bright Red)" />
      <button id="saveBtn">Save Color</button>
    </div>

    <div id="savedColors">
      <strong>Saved Colors:</strong><br>
      <div id="savedList"></div>
    </div>

    <p><small>For vivid colors: expect low/no white to keep intensity high.<br>
       Real paint mixing varies—test small batches! Use BEHR/Glidden + black + white/base.</small></p>
  </div>

  <script>
    const picker = document.getElementById('colorPicker');
    const preview = document.getElementById('colorPreview');
    const hexDisplay = document.getElementById('targetHex');
    const saveBtn = document.getElementById('saveBtn');
    const colorNameInput = document.getElementById('colorName');
    const savedList = document.getElementById('savedList');

    const cyanEl    = document.getElementById('cyanRatio');
    const magentaEl  = document.getElementById('magentaRatio');
    const yellowEl   = document.getElementById('yellowRatio');
    const blackEl    = document.getElementById('blackRatio');
    const whiteEl    = document.getElementById('whiteRatio');

    const cyanMlEl   = document.getElementById('cyanMl');
    const magentaMlEl = document.getElementById('magentaMl');
    const yellowMlEl  = document.getElementById('yellowMl');
    const blackMlEl   = document.getElementById('blackMl');
    const whiteMlEl   = document.getElementById('whiteMl');

    // Load saved colors from localStorage
    let savedColors = JSON.parse(localStorage.getItem('savedPaintColors')) || [];

    function rgbToCmyk(r, g, b) {
      let rn = r / 255, gn = g / 255, bn = b / 255;
      let c = 1 - rn, m = 1 - gn, y = 1 - bn;
      let k = Math.min(c, m, y, 1);

      if (k >= 1) return { c: 0, m: 0, y: 0, k: 100, w: 0 };

      c = (c - k) / (1 - k) || 0;
      m = (m - k) / (1 - k) || 0;
      y = (y - k) / (1 - k) || 0;

      let cPct = Math.round(c * 100);
      let mPct = Math.round(m * 100);
      let yPct = Math.round(y * 100);
      let kPct = Math.round(k * 100);

      let totalInk = cPct + mPct + yPct + kPct;
      let wPct = 100 - totalInk;

      if (totalInk > 100) {
        const scale = 100 / totalInk;
        cPct = Math.round(cPct * scale);
        mPct = Math.round(mPct * scale);
        yPct = Math.round(yPct * scale);
        kPct = Math.round(kPct * scale);
        wPct = 100 - (cPct + mPct + yPct + kPct);
      }

      wPct = Math.max(0, wPct);
      let finalSum = cPct + mPct + yPct + kPct + wPct;
      if (finalSum !== 100) wPct += 100 - finalSum;

      return { c: cPct, m: mPct, y: yPct, k: kPct, w: wPct };
    }

    function updateFromColor(hex) {
      let r = parseInt(hex.slice(1,3), 16);
      let g = parseInt(hex.slice(3,5), 16);
      let b = parseInt(hex.slice(5,7), 16);

      preview.style.backgroundColor = hex;
      hexDisplay.textContent = hex.toUpperCase();

      const { c, m, y, k, w } = rgbToCmyk(r, g, b);

      cyanEl.textContent    = c + '%';    cyanMlEl.textContent    = (c / 10).toFixed(1);
      magentaEl.textContent  = m + '%';   magentaMlEl.textContent  = (m / 10).toFixed(1);
      yellowEl.textContent   = y + '%';   yellowMlEl.textContent   = (y / 10).toFixed(1);
      blackEl.textContent    = k + '%';   blackMlEl.textContent    = (k / 10).toFixed(1);
      whiteEl.textContent    = w + '%';   whiteMlEl.textContent    = (w / 10).toFixed(1);
    }

    function renderSavedColors() {
      savedList.innerHTML = '';
      savedColors.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'saved-item';
        div.innerHTML = `
          <div class="saved-swatch" style="background:${item.hex}"></div>
          <span>\( {item.name} ( \){item.hex})</span>
        `;
        div.onclick = () => {
          picker.value = item.hex;
          updateFromColor(item.hex);
        };
        savedList.appendChild(div);
      });
    }

    // Save current color
    saveBtn.onclick = () => {
      const hex = picker.value;
      let name = colorNameInput.value.trim();
      if (!name) name = `Color ${savedColors.length + 1}`;

      savedColors.push({ name, hex });
      localStorage.setItem('savedPaintColors', JSON.stringify(savedColors));
      renderSavedColors();
      colorNameInput.value = ''; // clear input
    };

    // Initial setup
    updateFromColor(picker.value);
    renderSavedColors();

    picker.addEventListener('input', (e) => updateFromColor(e.target.value));
  </script>
</body>
</html>